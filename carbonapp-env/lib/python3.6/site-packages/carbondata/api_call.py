import requests

class GridData :

    def __init__(self, intervals):
        self.intervals = intervals
        grid_response = requests.get(
            'https://api.carbonintensity.org.uk/regional/regionid/3'
        )
        self.grid_data = grid_response.json()
        self.utc_time = self.grid_data['data'][0]['data'][0]['from']
        fcast_response = requests.get('''
                https://api.carbonintensity.org.uk/regional/intensity/{}/fw24h/regionid/3
                '''.format(self.utc_time)
                                      )
        self.fcast_data = fcast_response.json()

    def now(self):

        now_intensity = self.grid_data['data'][0]['data'][0]['intensity']['forecast']
        fuel_name = self.grid_data['data'][0]['data'][0]['generationmix'][-1]['fuel']
        fuel_pc = self.grid_data['data'][0]['data'][0]['generationmix'][-1]['perc']

        return self.utc_time, now_intensity, fuel_name, fuel_pc

    def future(self):

        fcast_display = []
        for interval in range(0, self.intervals):
            time = self.fcast_data['data']['data'][interval]['from']
            intensity = self.fcast_data['data']['data'][interval]['intensity']['forecast']
            wind_pc = int(self.fcast_data['data']['data'][interval]['generationmix'][-1]['perc'])

            fcast_display.append(time[11:] + ' : ' + str(intensity) + ' ,  ' + str(wind_pc))
        return fcast_display[0::2]